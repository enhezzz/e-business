<template>
  <div class="category">
    <div class="title">
      <div class="title-box">
        <h2 class="theme">主题市场</h2>
      <div class="sub">
        <div class="item">
          <router-link to="/productList">商品列表</router-link>
        </div>
      </div>
      </div>
      
    </div>
    <div class="detail">
      <div class="detail-box">
         <div class="list">
        <div class="type">
          <div class="main-title">
            <router-link to="/">隔离带</router-link>/
            <router-link to="/">隔离带</router-link>/
            <router-link to="/">隔离带</router-link>
            <span class="arrow">></span>
          </div>
          <div class="detail-title">
          </div>
        </div>
        <div class="type">
          <div class="main-title">
            <router-link to="/">隔离带</router-link>/
            <router-link to="/">隔离带</router-link>/
            <router-link to="/">隔离带</router-link>
            <span class="arrow">></span>
          </div>
          <div class="detail-title">

          </div>
        </div>
        <div class="type">
          <div class="main-title">
            <router-link to="/">隔离带</router-link>/
            <router-link to="/">隔离带</router-link>/
            <router-link to="/">隔离带</router-link>
            <span class="arrow">></span>
          </div>
          <div class="detail-title">

          </div>
        </div>
        <div class="type">
          <div class="main-title">
            <router-link to="/">隔离带</router-link>/
            <router-link to="/">隔离带</router-link>/
            <router-link to="/">隔离带</router-link>
            <span class="arrow">></span>
          </div>
          <div class="detail-title">

          </div>
        </div>
        <div class="type">
          <div class="main-title">
            <router-link to="/">隔离带</router-link>/
            <router-link to="/">隔离带</router-link>/
            <router-link to="/">隔离带</router-link>
            <span class="arrow">></span>
          </div>
          <div class="detail-title">

          </div>
        </div>
        <div class="type">
          <div class="main-title">
            <router-link to="/">隔离带</router-link>/
            <router-link to="/">隔离带</router-link>/
            <router-link to="/">隔离带</router-link>
            <span class="arrow">></span>
          </div>
          <div class="detail-title">

          </div>
        </div>
        <div class="type">
          <div class="main-title">
            <router-link to="/">隔离带</router-link>/
            <router-link to="/">隔离带</router-link>/
            <router-link to="/">隔离带</router-link>
            <span class="arrow">></span>
          </div>
          <div class="detail-title">

          </div>
        </div>
        <div class="type">
          <div class="main-title">
            <router-link to="/">隔离带</router-link>/
            <router-link to="/">隔离带</router-link>/
            <router-link to="/">隔离带</router-link>
            <span class="arrow">></span>
          </div>
          <div class="detail-title">

          </div>
        </div>
        <div class="type">
          <div class="main-title">
            <router-link to="/">隔离带</router-link>/
            <router-link to="/">隔离带</router-link>/
            <router-link to="/">隔离带</router-link>
            <span class="arrow">></span>
          </div>
          <div class="detail-title">

          </div>
        </div>
        <div class="type">
          <div class="main-title">
            <router-link to="/">隔离带</router-link>/
            <router-link to="/">隔离带</router-link>/
            <router-link to="/">隔离带</router-link>
            <span class="arrow">></span>
          </div>
          <div class="detail-title">

          </div>
        </div>
        <div class="type">
          <div class="main-title">
            <router-link to="/">隔离带</router-link>/
            <router-link to="/">隔离带</router-link>/
            <router-link to="/">隔离带</router-link>
            <span class="arrow">></span>
          </div>
          <div class="detail-title">

          </div>
        </div>
        <div class="type">
          <div class="main-title">
            <router-link to="/">隔离带</router-link>/
            <router-link to="/">隔离带</router-link>/
            <router-link to="/">隔离带</router-link>
            <span class="arrow">></span>
          </div>
          <div class="detail-title">

          </div>
        </div>
        <div class="type">
          <div class="main-title">
            <router-link to="/">隔离带</router-link>/
            <router-link to="/">隔离带</router-link>/
            <router-link to="/">隔离带</router-link>
            <span class="arrow">></span>
          </div>
          <div class="detail-title">

          </div>
        </div>
        <div class="type">
          <div class="main-title">
            <router-link to="/">隔离带</router-link>/
            <router-link to="/">隔离带</router-link>/
            <router-link to="/">隔离带</router-link>
            <span class="arrow">></span>
          </div>
          <div class="detail-title">

          </div>
        </div>
        <div class="type">
          <div class="main-title">
            <router-link to="/">隔离带</router-link>/
            <router-link to="/">隔离带</router-link>/
            <router-link to="/">隔离带</router-link>
            <span class="arrow">></span>
          </div>
          <div class="detail-title">

          </div>
        </div>
        <div class="type">
          <div class="main-title">
            <router-link to="/">隔离带</router-link>/
            <router-link to="/">隔离带</router-link>/
            <router-link to="/">隔离带</router-link>
            <span class="arrow">></span>
          </div>
          <div class="detail-title">

          </div>
        </div>
        
      </div>
      <div class="hot">
        <div class="advantages">
          <div class="carousel">
            <div class="items">
              <a href="#" class="prod">
              <img src="../assets/carousel1.png" alt="">
              </a>
              <a href="#" class="prod">
              <img src="../assets/carousel1.png" alt="">
              </a>
              <a href="#" class="prod">
              <img src="../assets/carousel1.png" alt="">
              </a>
            </div>
            <div class="main-controlers">
              <div class="item"></div>
              <div class="item"></div>
              <div class="item"></div>
            </div>
            <div class="left-controler">
              <span><</span>
            </div>
            <div class="right-controler">
               <span>></span>
            </div>
          </div>
        </div>
        <div class="info">
          <div class="my-info">
            <div class="avatar">
              <img :src="avatarPath" alt="">
            </div>
            <div class="action">
              <router-link to="login" v-if="!isLogin">登陆</router-link>
              <router-link to="register" v-if="!isLogin">注册</router-link>
              <router-link to="/personalCenter" v-if="isLogin">个人中心</router-link>
            </div>
          </div>
          <div class="news">
            <div class="title">
              上新:
            </div>
            <div class="prods">
              <ul>
                <li v-for="(p,index) of news">
                  <router-link :to="'/product/'+p._id">{{index+1+':'+p.p_name}}</router-link>
                </li>
              </ul>
            </div>
          </div>
        </div>
      </div>
      </div>
     
    </div>
  </div>
</template>

<script>
export default {
  name: "HelloWorld",
  data() {
    return {
      news: [],
      avatarPath: "",
    }
  },
  computed: {
    isLogin(){
      return this.$store.state.isLogin;
    }
  }
  ,
  created: function(){
    if(fetch){
      fetch('/newProds',{
        method: 'get'
      }).then(response=>{
        return response.json();
      }).then(news=>{
        this.news = news
      }).catch(err=>{
        if(err) throw err;
      });
      fetch('/getInfo',{
        credentials: 'same-origin'
      }).then(response=>{
        return response.text()
      }).then(avatarPath=>{
        this.avatarPath = avatarPath;
      }).catch(err=>{
        if(err) throw err;
      })
    }
  },
  mounted(){
    var container = document.querySelector('.carousel');
    var slider = document.querySelector('.items');
    var leftArrow = document.querySelector('.left-controler');
    var rightArrow = document.querySelector('.right-controler');
    var circleControlers = document.querySelectorAll('.main-controlers>.item');
    this.carousel(container,slider,leftArrow,rightArrow,circleControlers)
  },
  methods:{
    carousel(container,slider,leftArrow,rightArrow,circleControlers){
    let picIndex = 0;
    let timer = null;
    let containerWidth = parseInt(window.getComputedStyle(container,null).width || container.currentStyle.width)
    // console.log(container,slider,leftArrow,rightArrow,circleControlers)
    let circleControlersLength = circleControlers.length;
    timer = setInterval(function () {
        if (picIndex > circleControlersLength-1) {
            picIndex = 0;
        }
        slider.style.left = -picIndex * containerWidth + 'px';
        circleControlers.forEach((controler) => {
            controler.classList.remove('active');
        })
        circleControlers[picIndex].classList.add('active')
        picIndex++;
        // console.log(picIndex > 4)
        // console.log(picIndex)
    }, 2000);
    container.onmouseenter = function () {
        clearInterval(timer);
    }
    container.onmouseleave = function () {
        timer = setInterval(function () {
            if (picIndex > circleControlersLength-1) {
                picIndex = 0;
            }
            slider.style.left = -picIndex * containerWidth + 'px';
            circleControlers.forEach((controler) => {
                controler.classList.remove('active');
            })
            circleControlers[picIndex].classList.add('active')
            picIndex++;
            // console.log(picIndex > 4)
            // console.log(picIndex)
        }, 2000);
    }
    leftArrow.onclick = function () {
        picIndex--;
        if (picIndex < 0)
            picIndex = circleControlersLength-1;
        console.log(picIndex)
        slider.style.left = -picIndex * containerWidth + 'px';
        circleControlers.forEach((controler) => {
            controler.classList.remove('active');
        })
        circleControlers[picIndex].classList.add('active')
    }
    rightArrow.onclick = function () {
        picIndex++;
        if (picIndex > circleControlersLength-1)
            picIndex = 0;
        slider.style.left = -picIndex * containerWidth + 'px';
        circleControlers.forEach((controler) => {
            controler.classList.remove('active');
        })
        circleControlers[picIndex].classList.add('active')
    }
    circleControlers.forEach((controler, index) => {
        controler.onclick = function () {
            picIndex = index;
            slider.style.left = -picIndex * containerWidth + 'px';
            circleControlers.forEach((controler) => {
                controler.classList.remove('active');
            })
            circleControlers[picIndex].classList.add('active')
        }
    })
}

  }
};
</script>

<!-- Add "scoped" attribute to limit CSS to this component only -->
<style scoped>
.category>.title{
   background: #9999CC
}
.category>.title>.title-box{
  display: flex;
  width:1190px;
  margin: 0 auto
}
.category .title .theme{
  flex: 0 1 206px;
  color: white;
  font-size: 17px;
  font-weight: 600;
  text-align: center;
  background: rgb(153, 153, 238);
  margin: 0;
  height: 47px;
  line-height: 47px
}
.category .title .sub{
  flex: 1;
  display: flex;
  justify-content: flex-start;
  background: #9999CC
}
.category .title .sub .item a{
  color: white;
  font-size: 17px;
  font-weight: 600;
  display: block;
  height: 47px;
  line-height: 47px;
  padding: 0 15px
}
.category .detail .detail-box{
  display: flex;
  width: 1190px;
  margin: 0 auto
}
.category .detail .list{
  flex: 0 1 206px;
  padding-top: 6px;
  border: 1px solid rgb(153, 153, 238)
}
.category .detail .list .type .main-title{
  text-align: center;
  padding: 6px 0;
}
.category .detail .list .type .main-title .arrow{
  float: right;
}
.category .detail .list .type .main-title:hover{
  background: rgba(153, 153, 238,.4);
  transition: background-color .4s;
}
.category .detail .list .type .main-title:hover *{
  color:rgb(153, 153, 238);
}
.category .detail .list .type .main-title a:hover{
  text-decoration: underline;
}
.category .detail .hot{
  flex: 1;
  display: flex;
  padding: 10px 0 0 10px
}
.category .detail .hot .advantages{
  flex: 0 1 745px
}
.category .detail .hot .advantages .carousel{
  height: 100%;
  position: relative;
  width: 745px;
  overflow: hidden;
}
.category .detail .hot .advantages .carousel>.items{
  width: 2235px;
  position: absolute;
  left: 0;
  transition: left .4s
}
.category .detail .hot .advantages .carousel .prod{
  /* width: 100%; */
  height: 100%;
  display: block;
  float: left;
}
.category .detail .hot .advantages .carousel .main-controlers{
  position: absolute;
  background: rgba(188, 188, 188, .4);
  bottom: 15px;
  left: 50%;
  transform: translateX(-50%);
  border-radius: 6px;
}
.category .detail .hot .advantages .carousel .main-controlers .item{
  display: inline-block;
  width: 12px;
  height: 12px;
  border-radius: 50%;
  margin: 5px;
  background: rgb(233, 233, 233);
}
.category .detail .hot .advantages .carousel .main-controlers .item.active{
  display: inline-block;
  width: 12px;
  height: 12px;
  border-radius: 50%;
  margin: 5px;
  background: #fff;
}
.category .detail .hot .advantages .carousel .left-controler{
  width: 36px;
  height: 36px;
  line-height: 36px;
  text-align: center;
  border-radius: 0 50% 50% 0;
  background: rgba(188, 188, 188, .4);
  position: absolute;
  top: 50%;
  left: 0;
  transform: translateY(-50%);
  display: none;
}
.category .detail .hot .advantages .carousel .right-controler{
  width: 36px;
  height: 36px;
  line-height: 36px;
  text-align: center;
  border-radius: 50% 0 0 50%;
  background: rgba(188, 188, 188, .4);
  position: absolute;
  top: 50%;
  right: 0;
  transform: translateY(-50%);
  display: none;
}
.category .detail .hot .advantages .carousel:hover .right-controler,
.category .detail .hot .advantages .carousel:hover .left-controler{
  display: block;
  cursor: default;
}
.category .detail .hot .info{
  flex: 1;
  margin-left: 12px
}
.category .detail .hot .info .my-info{
  border-bottom: 1px solid #9999EE
}
.category .detail .hot .info .my-info .avatar{
  width: 60px;
  height: 60px;
  margin: 0 auto;
  border-radius: 50%;
  border: 1px solid #eee;
  overflow: hidden;
}
.category .detail .hot .info .my-info .avatar>img{
  width: 100%;
  height: 100%;
}
.category .detail .hot .info .my-info .action{
  display: flex;
  justify-content: center
}
.category .detail .hot .info .my-info .action a{
  display: block;
  width: 68px;
  height: 30px;
  line-height: 30px;
  text-align: center;
  background: #9999EE;
  margin: 15px;
  border-radius: 5px;
  font-weight: 700;
  color: #fff
}
.category .detail .hot .info .news .title{
    margin-top: 15px;
}
.category .detail .hot .info .prods li{
    height: 29px;
    line-height: 29px;
}
.category .detail .hot .info .prods li:nth-of-type(1)>a{
    color: rgb(211, 144, 233);
}
.category .detail .hot .info .prods li:nth-of-type(2)>a{
    color: rgb(211, 144, 233);
}
.category .detail .hot .info .prods li:nth-of-type(3)>a{
    color: rgb(211, 144, 233);
}

.category .detail .hot .info .prods li>a{
    display: block;
    width: 100%;
    height: 100%;
}
.category .detail .hot .info .prods li>a:hover{
    background: rgb(235, 235, 235);
}

</style>
